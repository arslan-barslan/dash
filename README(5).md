# Отчет по проекту: Мониторинг Docker-контейнеров

## 1. Цель работы

Развертывание системы мониторинга для отслеживания ресурсов Docker-контейнеров в реальном времени с использованием стека **Prometheus**, **cAdvisor** и **Grafana**. Система позволяет собирать и визуализировать метрики потребления CPU, памяти и сетевого трафика контейнеризованных приложений.

## 2. Используемые компоненты

- **webapp (nginx)** — тестовое веб-приложение на базе Nginx для мониторинга и генерации нагрузки.
- **cAdvisor** — контейнерный агент для сбора метрик производительности (CPU, RAM, Network) напрямую из контейнеров Docker.
- **Prometheus** — база данных временных рядов (TSDB) для хранения и запросов собранных метрик.
- **Grafana** — платформа визуализации данных и создания интерактивных дашбордов.

## 3. Архитектура и конфигурация

### 3.1 Docker Compose конфигурация

Все сервисы развернуты с использованием `docker-compose.yml` версии 3.8:

**Структура сервисов:**

| Сервис | Образ | Порты | Статус |
|--------|-------|-------|--------|
| webapp | nginx:latest | 80→80 | Running |
| cAdvisor | gcr.io/cadvisor:latest | 8080→8080 | Running (healthy) |
| Prometheus | prom/prometheus:latest | 9090→9090 | Running |
| Grafana | grafana/grafana:latest | 3000→3000 | Running |

### 3.2 Конфигурация Prometheus

**Основные параметры:**
- **Scrape интервал**: 5 секунд
- **Target**: cAdvisor на порту 8080
- **Формат**: static_configs с прямым указанием адреса `cAdvisor:8080`

Prometheus настроен на сбор метрик с cAdvisor с высокой частотой (5с), что позволяет зафиксировать даже короткие всплески нагрузки.

### 3.3 Монтирование томов cAdvisor

cAdvisor имеет доступ к системным ресурсам через следующие mount points:
- `/rootfs:ro` — корневая файловая система
- `/var/run:/var/run:ro` — runtime сокеты
- `/sys:/sys:ro` — системная информация
- `/var/lib/docker/:/var/lib/docker:ro` — хранилище образов и контейнеров

## 4. Статус запущенных контейнеров

Все четыре контейнера находятся в статусе **Running** и работают более 45 секунд:

- ✅ **webapp** (d808b82bb1da) — nginx:latest | Запущен 45 секунд назад
- ✅ **prometheus** (144c05b763a4) — prom/prometheus:latest | Запущен 45 секунд назад
- ✅ **grafana** (c8065219ff3d) — grafana/grafana:latest | Запущен 45 секунд назад
- ✅ **cAdvisor** (d067eb28e379) — gcr.io/cadvisor:latest | Запущен 45 секунд назад (healthy)

## 5. Проверка сбора данных

### 5.1 Работа cAdvisor

cAdvisor успешно обнаружил и индексировал все запущенные контейнеры. Веб-интерфейс (localhost:8080/containers/) отображает:

**Использование памяти:**
- **Total**: ~3200 МB (стабильное потребление)
- **Hot memory**: ~2100 МB (активно используемая память)
- **Распределение**: 81% от выделенных 3.82 ГiB

Метрика потребления памяти остается стабильной в состоянии без нагрузки с небольшими колебаниями (~100-150 МB).

### 5.2 Сетевой интерфейс

**Интерфейс**: enp0s3

cAdvisor отслеживает трафик через основной сетевой интерфейс. В состоянии покоя пропускная способность минимальна. При нагрузке фиксируются следующие показатели:

| Метрика | Пиковое значение |
|---------|-----------------|
| Tx bytes (исходящие) | ~23,000 байт/сек |
| Rx bytes (входящие) | ~18,000 байт/сек |
| Общий трафик | ~41,000 байт/сек |

### 5.3 Статус источников в Prometheus

В веб-интерфейсе Prometheus (Status → Targets) подтверждено:

- **Endpoint**: http://cAdvisor:8080/metrics
- **Состояние**: UP ✅ (healthy)
- **Last scrape**: 1.081s ago
- **Scrape duration**: 595ms

Prometheus успешно собирает метрики с интервалом 5 секунд, задержка сбора составляет менее 600ms, что свидетельствует о хорошей производительности.

## 6. Визуализация в Grafana

### 6.1 Подключение источника данных

В Grafana подключен источник данных Prometheus, который служит основой для всех дашбордов. Система готова к созданию кастомных визуализаций и аналитики.

### 6.2 Дашборд CPU usage

На дашборде CPU usage зафиксированы два ключевых состояния:

**Состояние в покое (10:45 - 10:50):**
- CPU usage: близко к 0
- Стабильное потребление процессора
- Система готова к нагрузке

**Состояние под нагрузкой (10:50 - 10:55):**
- Резкий скачок CPU usage до 150-175 условных единиц
- Пиковое потребление фиксируется в течение ~4-5 минут
- Отчетливо видны две волны нагрузки (два пика)
- Сигнал от cAdvisor (синяя линия) показывает стабильно высокий уровень во время генерации запросов

**После снятия нагрузки (10:55+):**
- Быстрое падение CPU usage до базового уровня
- Система восстанавливается за несколько секунд
- Демонстрирует хорошую масштабируемость и отсутствие утечек ресурсов

## 7. Анализ нагрузочного тестирования

### 7.1 Сценарий тестирования

Нагрузка генерировалась посредством цикла curl-запросов к контейнеру webapp (nginx). Тестирование проводилось с целью оценки поведения системы мониторинга под нагрузкой.

### 7.2 Результаты

| Метрика | Значение |
|---------|----------|
| **CPU usage (idle)** | ~0-10 усл. ед. |
| **CPU usage (peak)** | 150-175 усл. ед. |
| **Memory (idle)** | ~2100 МB |
| **Memory (peak)** | ~2400 МB |
| **Network throughput (peak)** | ~23,000 Tx / ~18,000 Rx байт/сек |
| **Восстановление после нагрузки** | <5 секунд |

### 7.3 Выводы по нагрузке

1. **Стабильность**: Система стабильна и не показывает деградации при нагрузке
2. **Отзывчивость**: cAdvisor мгновенно фиксирует изменения в потреблении ресурсов
3. **Восстановление**: После снятия нагрузки ресурсы освобождаются быстро
4. **Точность мониторинга**: Prometheus (5s scrape interval) позволяет зафиксировать даже короткие всплески

## 8. Ключевые преимущества реализованного решения

1. **Без модификации кода приложения**: cAdvisor собирает метрики на уровне контейнера, не требуя изменений в коде webapp
2. **Гибкие временные ряды**: Prometheus хранит все метрики с высокой гранулярностью (5 сек), позволяя анализировать детальную историю
3. **Визуализация в реальном времени**: Grafana предоставляет интерактивные дашборды с возможностью быстрого анализа и создания алертов
4. **Масштабируемость**: Архитектура позволяет легко добавлять новые контейнеры для мониторинга
5. **Надежность**: Все компоненты контейнеризированы и легко управляются через docker-compose

## 9. Рекомендации для продакшена

1. **Добавить аlerts** в Prometheus для критических метрик (CPU > 80%, Memory > 90%)
2. **Расширить хранилище** Prometheus (текущее хранилище временных рядов может переполниться при длительной работе)
3. **Добавить dashboards** для мониторинга самих сервисов мониторинга (Prometheus, Grafana, cAdvisor)
4. **Интегрировать логирование** (ELK stack или Loki) для полного наблюдаемости
5. **Настроить резервное копирование** конфигураций Grafana и Prometheus
6. **Использовать persistent volumes** для сохранения данных между перезагрузками контейнеров

## 10. Заключение

Система мониторинга успешно развернута и демонстрирует надежную работу. cAdvisor, Prometheus и Grafana образуют мощный stack для наблюдаемости контейнеризованных приложений. Реализованное решение подходит как для целей разработки и тестирования, так и может служить основой для production-grade мониторинга при добавлении соответствующих расширений и hardening'а безопасности.

---

**Дата создания отчета**: 29 декабря 2025  
**Версия docker-compose**: 3.8  
**Окружение**: Docker контейнеры на локальной машине
